# =============================================================
# Homelab Automation — Environment Configuration
# =============================================================
# Copy this file to .env and fill in your values:
#   cp .env.example .env
#
# NEVER commit the plain .env file to git!
# Use ./scripts/secrets-encrypt.sh to encrypt → .env.enc (safe to commit)
# =============================================================

# --- Home Assistant ---
HA_URL=http://homeassistant.local:8123
HA_TOKEN=your_long_lived_access_token_here

# --- InfluxDB v2 ---
INFLUXDB_URL=http://your-influxdb-host:8086
INFLUXDB_TOKEN=your_influxdb_token_here
INFLUXDB_ORG=your_org_id_here
INFLUXDB_BUCKET=hass

# --- MQTT ---
# Must be the SAME broker HA uses (for MQTT auto-discovery to work).
# Use your external broker IP, NOT "mqtt" (the Docker container).
MQTT_HOST=mqtt
MQTT_PORT=1883
MQTT_USERNAME=
MQTT_PASSWORD=

# --- AI / LLM ---
OLLAMA_URL=http://ollama:11434
OPENAI_API_KEY=
ANTHROPIC_API_KEY=

# --- PV Forecast Service ---
# Entity IDs for your PV arrays — must be total_increasing cumulative kWh sensors
# (e.g. Riemann sum integration of the array power sensor)
PV_EAST_ENERGY_ENTITY_ID=sensor.inverter_pv_east_energy
PV_EAST_CAPACITY_KWP=5.0
PV_EAST_AZIMUTH=90
PV_EAST_TILT=30

PV_WEST_ENERGY_ENTITY_ID=sensor.inverter_pv_west_energy
PV_WEST_CAPACITY_KWP=5.0
PV_WEST_AZIMUTH=-90
PV_WEST_TILT=30

# Forecast.Solar "today" entities (optional — used as extra model feature)
# The code auto-discovers the matching "tomorrow" entity by replacing _today with _tomorrow.
FORECAST_SOLAR_EAST_ENTITY_ID=sensor.energy_production_today_east
FORECAST_SOLAR_WEST_ENTITY_ID=sensor.energy_production_today_west

# Location (leave at 0 to auto-detect from Home Assistant)
PV_LATITUDE=0
PV_LONGITUDE=0

# --- Smart EV Charging Service ---
# Economics (ct/kWh) — fixed rates, no EPEX spot market
EV_GRID_PRICE_CT=25.0
EV_FEED_IN_TARIFF_CT=7.0
EV_REIMBURSEMENT_CT=25.0

# EV battery SoC (from car, e.g. Audi Connect) — leave empty to disable
# When set, the service computes energy needed from SoC + capacity automatically.
# Set this to your car's SoC entity, e.g.: sensor.audi_q4_e_tron_state_of_charge
EV_SOC_ENTITY=

# Sensor entities (defaults match typical Amtron + Sungrow + Shelly setup)
# Grid connection meter (positive = exporting, negative = importing)
# GRID_POWER_ENTITY=sensor.power_meter_active_power
# Household consumption (Shelly 3EM, always positive)
# HOUSE_POWER_ENTITY=sensor.shelly3em_main_channel_total_power
# PV DC input power
# PV_POWER_ENTITY=sensor.inverter_input_power

# Home battery (positive = charging, negative = discharging)
# BATTERY_POWER_ENTITY=sensor.batteries_charge_discharge_power
# BATTERY_SOC_ENTITY=sensor.batteries_state_of_capacity
# BATTERY_MIN_SOC_PCT=20.0
# BATTERY_EV_ASSIST_MAX_W=2000.0

# PV forecast (used for battery-aware decisions)
# PV_FORECAST_REMAINING_ENTITY=sensor.pv_ai_forecast_today_remaining_kwh
# PV_FORECAST_GOOD_KWH=15.0

# Wallbox power limits (W) — defaults match Amtron 3-phase
# WALLBOX_MAX_POWER_W=11000
# WALLBOX_MIN_POWER_W=4200
# ECO_CHARGE_POWER_W=5000

# PV surplus tuning
# GRID_RESERVE_W=200
# SURPLUS_START_HYSTERESIS_W=300
# RAMP_STEP_W=500

# Control loop interval (seconds)
# CONTROL_INTERVAL_SECONDS=30

# --- General ---
LOG_LEVEL=INFO
TIMEZONE=Europe/Berlin

title: "‚ö° EV & Energy"
views:
  - title: "‚ö° EV & Energy"
    path: ev-energy
    icon: mdi:ev-station
    type: sections
    max_columns: 4
    sections:
      # =====================================================================
      # SECTION 1: EV Status (prominent, top-left)
      # =====================================================================
      - type: grid
        title: "üöó EV Status"
        cards:
          # --- Big SOC Gauge ---
          - type: gauge
            entity: sensor.audi_a6_avant_e_tron_state_of_charge_comb
            name: "Battery"
            unit: "%"
            needle: true
            min: 0
            max: 100
            severity:
              green: 60
              yellow: 30
              red: 0

          # --- Key Stats ---
          - type: entities
            entities:
              - entity: sensor.audi_a6_avant_e_tron_state_of_charge_comb
                name: "State of Charge"
                icon: mdi:car-battery
              - entity: sensor.audi_a6_avant_e_tron_target_state_of_charge_comb
                name: "Target SOC"
                icon: mdi:battery-charging-high
              - entity: sensor.audi_a6_avant_e_tron_range_comb
                name: "Range"
                icon: mdi:map-marker-distance
              - entity: sensor.audi_a6_avant_e_tron_charging_power_comb
                name: "Charging Power"
                icon: mdi:flash
              - entity: sensor.audi_a6_avant_e_tron_charging_state_comb
                name: "Charging State"
                icon: mdi:ev-plug-type2
              - entity: sensor.audi_a6_avant_e_tron_plug_state_comb
                name: "Plug State"
                icon: mdi:power-plug
              - entity: sensor.audi_a6_avant_e_tron_remaining_charge_time_comb
                name: "Time to Full"
                icon: mdi:battery-clock-outline
              - entity: sensor.audi_a6_avant_e_tron_mileage_comb
                name: "Mileage"
                icon: mdi:counter
              - entity: sensor.audi_a6_avant_e_tron_active_account_comb
                name: "Active Driver"
                icon: mdi:account-check

      # =====================================================================
      # SECTION 2: Charging Plan & Wallbox Control
      # =====================================================================
      - type: grid
        title: "üîå Charging Plan"
        cards:
          # --- Charge Mode & Controls ---
          - type: entities
            title: "Charge Control"
            entities:
              - entity: input_select.ev_charge_mode
                name: "Charge Mode"
                icon: mdi:ev-plug-type2
              - entity: input_boolean.ev_full_by_morning
                name: "Full by Morning"
                icon: mdi:weather-night
              - entity: input_datetime.ev_departure_time
                name: "Departure Time"
                icon: mdi:clock-outline
              - entity: input_number.ev_target_soc_pct
                name: "Target SOC"
                icon: mdi:battery-charging-80
              - entity: input_number.ev_target_energy_kwh
                name: "Target Energy"
                icon: mdi:lightning-bolt
              - entity: input_number.ev_battery_capacity_kwh
                name: "Battery Capacity"
                icon: mdi:car-battery

          # --- Wallbox (Amtron) Status ---
          - type: entities
            title: "Amtron Wallbox"
            entities:
              - entity: sensor.amtron_vehicle_state
                name: "Vehicle State"
                icon: mdi:car-electric
              - entity: sensor.amtron_availability
                name: "Availability"
                icon: mdi:check-circle
              - entity: sensor.amtron_meter_total_power_w
                name: "Wallbox Power"
                icon: mdi:flash
              - entity: sensor.amtron_charged_energy_session_kwh
                name: "Session Energy"
                icon: mdi:battery-charging
              - entity: number.amtron_hems_power_limit_w
                name: "HEMS Power Limit"
                icon: mdi:speedometer
              - entity: sensor.amtron_relay_state
                name: "Relay"
                icon: mdi:electric-switch
              - entity: sensor.amtron_plug_lock
                name: "Plug Lock"
                icon: mdi:lock
              - entity: switch.amtron_pause_charging
                name: "Pause Charging"
                icon: mdi:pause-circle
              - entity: sensor.amtron_charged_duration_hms
                name: "Charge Duration"
                icon: mdi:timer
              - entity: sensor.amtron_firmware_version
                name: "Firmware"
                icon: mdi:chip

      # =====================================================================
      # SECTION 3: PV & Battery
      # =====================================================================
      - type: grid
        title: "‚òÄÔ∏è PV & Battery"
        cards:
          # --- Battery SOC Gauge ---
          - type: gauge
            entity: sensor.batteries_state_of_capacity
            name: "Home Battery"
            unit: "%"
            needle: true
            min: 0
            max: 100
            severity:
              green: 50
              yellow: 20
              red: 0

          # --- Live Power ---
          - type: entities
            title: "Live Power"
            entities:
              - entity: sensor.inverter_input_power
                name: "PV Production"
                icon: mdi:solar-power
              - entity: sensor.inverter_pv_east_power
                name: "PV East"
                icon: mdi:solar-panel
              - entity: sensor.inverter_pv_west_power
                name: "PV West"
                icon: mdi:solar-panel-large
              - entity: sensor.power_meter_active_power
                name: "Grid Power"
                icon: mdi:transmission-tower
              - entity: sensor.shelly3em_main_channel_total_power
                name: "House Consumption"
                icon: mdi:home-lightning-bolt
              - entity: sensor.batteries_charge_discharge_power
                name: "Battery Power"
                icon: mdi:battery-charging
              - entity: sensor.batteries_state_of_capacity
                name: "Battery SOC"
                icon: mdi:battery-high

          # --- PV Forecast ---
          - type: entities
            title: "PV Forecast"
            entities:
              - entity: sensor.pv_ai_forecast_today_remaining_kwh
                name: "Today Remaining"
                icon: mdi:weather-sunny

          # --- Energy Prices ---
          - type: entities
            title: "Energy Prices"
            entities:
              - entity: sensor.price_per_kwh_electricity_grid_eur
                name: "Grid Price"
                icon: mdi:currency-eur

      # =====================================================================
      # SECTION 4: Energy Flow
      # =====================================================================
      - type: grid
        title: "üîÑ Energy Flow"
        cards:
          - type: energy-distribution
            link_dashboard: true

      # =====================================================================
      # SECTION 5: History & Charts
      # =====================================================================
      - type: grid
        title: "üìä History"
        cards:
          # --- EV SOC History ---
          - type: history-graph
            title: "EV SOC (24h)"
            hours_to_show: 24
            entities:
              - entity: sensor.audi_a6_avant_e_tron_state_of_charge_comb
                name: "EV SOC"

          # --- PV Production History ---
          - type: history-graph
            title: "PV Production (24h)"
            hours_to_show: 24
            entities:
              - entity: sensor.inverter_input_power
                name: "Total PV"
              - entity: sensor.inverter_pv_east_power
                name: "PV East"
              - entity: sensor.inverter_pv_west_power
                name: "PV West"

          # --- Grid & Consumption ---
          - type: history-graph
            title: "Grid & Consumption (24h)"
            hours_to_show: 24
            entities:
              - entity: sensor.power_meter_active_power
                name: "Grid"
              - entity: sensor.shelly3em_main_channel_total_power
                name: "House"
              - entity: sensor.batteries_charge_discharge_power
                name: "Battery"

          # --- Wallbox Power History ---
          - type: history-graph
            title: "Wallbox Charging (24h)"
            hours_to_show: 24
            entities:
              - entity: sensor.amtron_meter_total_power_w
                name: "Wallbox Power"

          # --- Battery SOC History ---
          - type: history-graph
            title: "Home Battery SOC (24h)"
            hours_to_show: 24
            entities:
              - entity: sensor.batteries_state_of_capacity
                name: "Battery SOC"

      # =====================================================================
      # SECTION 6: Vehicle Security
      # =====================================================================
      - type: grid
        title: "üîí Vehicle"
        cards:
          - type: glance
            title: "Security"
            columns: 4
            entities:
              - entity: binary_sensor.audi_a6_avant_e_tron_doors_locked_comb
                name: "Locked"
              - entity: binary_sensor.audi_a6_avant_e_tron_doors_comb
                name: "Doors"
              - entity: binary_sensor.audi_a6_avant_e_tron_windows_comb
                name: "Windows"
              - entity: binary_sensor.audi_a6_avant_e_tron_trunk_comb
                name: "Trunk"
              - entity: binary_sensor.audi_a6_avant_e_tron_plugged_in_comb
                name: "Plugged In"
              - entity: binary_sensor.audi_a6_avant_e_tron_is_charging_comb
                name: "Charging"
              - entity: sensor.audi_a6_avant_e_tron_climatisation_state_comb
                name: "Climate"
              - entity: sensor.audi_a6_avant_e_tron_external_power_comb
                name: "Ext. Power"
